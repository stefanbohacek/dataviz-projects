{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["/* globals Chart, scrollama, moment */\nimport ready from \"/js/modules/ready.min.js\";\nimport getMonth from \"/js/modules/getMonth.min.js\";\nimport highlightMax from \"/js/modules/highlightMax.min.js\";\nimport preloadImages from \"/js/modules/preloadImages.min.js\";\n\nready(async () => {\n  let showAll = false;\n  const resp = await fetch(\"/data/military-budget/military-budget-2021.json\");\n  const dataset = await resp.json();\n\n\n  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n    Chart.defaults.color = \"#fff\";\n    Chart.defaults.borderColor = \"#fff\";\n    Chart.defaults.backgroundColor = \"#fff\";\n  } else {\n    Chart.defaults.color = \"#172c66\";\n    Chart.defaults.borderColor = \"#8bd3dd\";\n    Chart.defaults.backgroundColor = \"#f3d2c1\";\n  }\n\n  const dataLabels = dataset.map(function (datapoint) {\n    return datapoint.country;\n  });\n\n  const dataValues = dataset.map(function (datapoint) {\n    return datapoint.budget;\n  });\n\n  const logos = dataset.map((d) => {\n    return {\n      src: `${window.location.pathname}/images/logos/${d.logo}.png`,\n      width: 20,\n      height: 20,\n    };\n  });\n\n  const data = {\n    labels: [],\n    datasets: [\n      {\n        label: \"Budget\",\n        borderWidth: 1,\n        data: [],\n      },\n    ],\n  };\n\n  const config = {\n    type: \"bar\",\n    data: data,\n    options: {\n      scales: {\n        x: {\n          display: false,\n        },\n        y: {\n          display: false,\n          suggestedMin: 50000,\n          startAtZero: false,\n          suggestedMax: Math.max(dataValues),\n          ticks: {\n            callback: function (value, index, values) {\n              return `${new Intl.NumberFormat(\"en-US\", {\n                style: \"currency\",\n                currency: \"USD\",\n              }).format(value)}B`;\n            },\n          },\n        },\n      },\n      plugins: {\n        legend: {\n          display: false,\n        },\n        title: {\n          display: true,\n          text: \"Top 10 Countries by Military Spending\",\n        },\n        subtitle: {\n          display: true,\n          text: \"2021 budget in billions of US Dollars\",\n          padding: {\n            bottom: 30,\n          },\n        },\n        tooltip: {\n          callbacks: {\n            label: function (context) {\n              let label = context.dataset.label || \"\";\n              if (label) {\n                label += \": \";\n              }\n              if (context.parsed.y !== null) {\n                label += `${new Intl.NumberFormat(\"en-US\", {\n                  style: \"currency\",\n                  currency: \"USD\",\n                }).format(context.parsed.y)}B`;\n              }\n              return label;\n            },\n          },\n        },\n        datalabels: {\n          anchor: \"end\",\n          align: \"start\",\n        },\n        labels: {\n          render: \"image\",\n          textMargin: -16,\n          images: logos,\n        },\n      },\n    },\n    plugins: {\n      tooltip: {\n        callbacks: {\n          title: function (tooltipItems) {\n            const title = tooltipItems[0].label;\n            const year = title.split(\"/\")[0];\n            const month = getMonth(parseInt(title.split(\"/\")[1]) - 1);\n            return `${month} ${year}`;\n          },\n          label: function (context) {\n            let label = context.dataset.label || \"\";\n            if (label) {\n              label += \": \";\n            }\n            if (context.parsed.y !== null) {\n              label += `$${new Intl.NumberFormat(\"en-US\", {\n                style: \"currency\",\n                currency: \"USD\",\n              }).format(context.parsed.y)}B`;\n            }\n            return label;\n          },\n        },\n      },\n    },\n  };\n\n  const chart = new Chart(document.getElementById(\"chart\"), config);\n\n  const description = document.getElementById(\"description\");\n  const menuIcon = document.getElementById(\"menu-icon\");\n  const scroller = scrollama();\n\n  scroller\n    .setup({\n      step: \".step\",\n    })\n    .onStepEnter(function (response) {\n      /* response = { direction, element, index }, */\n      // console.log('onStepEnter', response);\n      // console.log('onStepEnter', response.index, response.direction);\n\n      // if (response.index === 0){\n      //     description.innerHTML = '';\n      // }\n\n      chart.options.scales.x.display = true;\n      chart.options.scales.y.display = true;\n\n      if (!showAll) {\n        chart.data.datasets[0].data = dataValues.slice(0, response.index + 1);\n        chart.data.datasets[0].backgroundColor = dataset.map((d, i) =>\n          i === 0 ? \"rgb(255, 99, 132)\" : Chart.defaults.backgroundColor\n        );\n        chart.data.labels = dataLabels.slice(0, response.index + 1);\n        // chart.data.labels[response.index] = dataLabels[response.index];\n\n        description.innerHTML = \"\";\n        chart.update();\n        highlightMax(chart);\n      }\n\n      if (response.index === dataset.length - 1) {\n        showAll = true;\n      }\n    })\n    .onStepExit(function (response) {\n      /* response = { direction, element, index }, */\n      // console.log('onStepExit', response);\n      // console.log('onStepExit', response.index, response.direction);\n      // if (menuIcon && ((response.direction === 'up' && response.index === 0) || (response.direction === 'down' && response.index === datasets.length - 1))){\n      //     menuIcon.classList.remove('d-none');\n      // }\n    });\n\n  window.addEventListener(\"resize\", scroller.resize);\n\n  preloadImages(\n    logos.map(function (logo) {\n      return logo.src;\n    })\n  );\n});\n"],"file":"main.min.js"}