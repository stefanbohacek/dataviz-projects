{"version":3,"names":[],"mappings":"","sources":["scripts.js"],"sourcesContent":["/* globals Chart, scrollama, moment */\n\nfunction ready( fn ) {\n    if ( document.readyState !== 'loading' ){\n        fn();\n    } else {\n        document.addEventListener( 'DOMContentLoaded', fn );\n    }\n}\n\nready( function(){\n    const Utils = {\n        isoDayOfWeek: function(dt) {\n          let wd = dt.getDay(); // 0..6, from sunday\n          wd = (wd + 6) % 7 + 1; // 1..7 from monday\n          return '' + wd; // string so it gets parsed\n        },\n        startOfToday: function() {\n          const d = new Date();\n          return new Date(d.getFullYear(), d.getMonth(), d.getDate(), 0, 0, 0, 0);\n        }\n    };\n\n    const overshootDays = {\n        '1971':{\n            overshoot_day: '12-25',\n            days_lasted: 358,\n            days_left: 7,\n            percent_lasted: 98.08\n        },\n        '1972':{\n            overshoot_day: '12-14',\n            days_lasted: 348,\n            days_left: 18,\n            percent_lasted: 95.08\n        },\n        '1973':{\n            overshoot_day: '12-01',\n            days_lasted: 334,\n            days_left: 31,\n            percent_lasted: 91.51\n        },\n        '1974':{\n            overshoot_day: '12-02',\n            days_lasted: 335,\n            days_left: 30,\n            percent_lasted: 91.78\n        },\n        '1975':{\n            overshoot_day: '12-04',\n            days_lasted: 337,\n            days_left: 28,\n            percent_lasted: 92.33\n        },\n        '1976':{\n            overshoot_day: '11-21',\n            days_lasted: 325,\n            days_left: 41,\n            percent_lasted: 88.8\n        },\n        '1977':{\n            overshoot_day: '11-15',\n            days_lasted: 318,\n            days_left: 47,\n            percent_lasted: 87.12\n        },\n        '1978':{\n            overshoot_day: '11-11',\n            days_lasted: 314,\n            days_left: 51,\n            percent_lasted: 86.03\n        },\n        '1979':{\n            overshoot_day: '11-02',\n            days_lasted: 305,\n            days_left: 60,\n            percent_lasted: 83.56\n        },\n        '1980':{\n            overshoot_day: '11-08',\n            days_lasted: 312,\n            days_left: 54,\n            percent_lasted: 85.25\n        },\n        '1981':{\n            overshoot_day: '11-15',\n            days_lasted: 318,\n            days_left: 47,\n            percent_lasted: 87.12\n        },\n        '1982':{\n            overshoot_day: '11-19',\n            days_lasted: 322,\n            days_left: 43,\n            percent_lasted: 88.22\n        },\n        '1983':{\n            overshoot_day: '11-19',\n            days_lasted: 322,\n            days_left: 43,\n            percent_lasted: 88.22\n        },\n        '1984':{\n            overshoot_day: '11-11',\n            days_lasted: 315,\n            days_left: 51,\n            percent_lasted: 86.07\n        },\n        '1985':{\n            overshoot_day: '11-08',\n            days_lasted: 311,\n            days_left: 54,\n            percent_lasted: 85.21\n        },\n        '1986':{\n            overshoot_day: '11-03',\n            days_lasted: 306,\n            days_left: 59,\n            percent_lasted: 83.84\n        },\n        '1987':{\n            overshoot_day: '10-27',\n            days_lasted: 299,\n            days_left: 66,\n            percent_lasted: 81.92\n        },\n        '1988':{\n            overshoot_day: '10-18',\n            days_lasted: 291,\n            days_left: 75,\n            percent_lasted: 79.51\n        },\n        '1989':{\n            overshoot_day: '10-15',\n            days_lasted: 287,\n            days_left: 78,\n            percent_lasted: 78.63\n        },\n        '1990':{\n            overshoot_day: '10-14',\n            days_lasted: 286,\n            days_left: 79,\n            percent_lasted: 78.36\n        },\n        '1991':{\n            overshoot_day: '10-13',\n            days_lasted: 285,\n            days_left: 80,\n            percent_lasted: 78.08\n        },\n        '1992':{\n            overshoot_day: '10-15',\n            days_lasted: 288,\n            days_left: 78,\n            percent_lasted: 78.69\n        },\n        '1993':{\n            overshoot_day: '10-15',\n            days_lasted: 287,\n            days_left: 78,\n            percent_lasted: 78.63\n        },\n        '1994':{\n            overshoot_day: '10-13',\n            days_lasted: 285,\n            days_left: 80,\n            percent_lasted: 78.08\n        },\n        '1995':{\n            overshoot_day: '10-07',\n            days_lasted: 279,\n            days_left: 86,\n            percent_lasted: 76.44\n        },\n        '1996':{\n            overshoot_day: '10-04',\n            days_lasted: 277,\n            days_left: 89,\n            percent_lasted: 75.68\n        },\n        '1997':{\n            overshoot_day: '10-01',\n            days_lasted: 273,\n            days_left: 92,\n            percent_lasted: 74.79\n        },\n        '1998':{\n            overshoot_day: '10-01',\n            days_lasted: 273,\n            days_left: 92,\n            percent_lasted: 74.79\n        },\n        '1999':{\n            overshoot_day: '10-01',\n            days_lasted: 273,\n            days_left: 92,\n            percent_lasted: 74.79\n        },\n        '2000':{\n            overshoot_day: '09-25',\n            days_lasted: 268,\n            days_left: 98,\n            percent_lasted: 73.22\n        },\n        '2001':{\n            overshoot_day: '09-24',\n            days_lasted: 266,\n            days_left: 99,\n            percent_lasted: 72.88\n        },\n        '2002':{\n            overshoot_day: '09-21',\n            days_lasted: 263,\n            days_left: 102,\n            percent_lasted: 72.05\n        },\n        '2003':{\n            overshoot_day: '09-11',\n            days_lasted: 253,\n            days_left: 112,\n            percent_lasted: 69.32\n        },\n        '2004':{\n            overshoot_day: '09-02',\n            days_lasted: 245,\n            days_left: 121,\n            percent_lasted: 66.94\n        },\n        '2005':{\n            overshoot_day: '08-26',\n            days_lasted: 237,\n            days_left: 128,\n            percent_lasted: 64.93\n        },\n        '2006':{\n            overshoot_day: '08-21',\n            days_lasted: 232,\n            days_left: 133,\n            percent_lasted: 63.56\n        },\n        '2007':{\n            overshoot_day: '08-15',\n            days_lasted: 226,\n            days_left: 139,\n            percent_lasted: 61.92\n        },\n        '2008':{\n            overshoot_day: '08-15',\n            days_lasted: 227,\n            days_left: 139,\n            percent_lasted: 62.02\n        },\n        '2009':{\n            overshoot_day: '08-19',\n            days_lasted: 230,\n            days_left: 135,\n            percent_lasted: 63.01\n        },\n        '2010':{\n            overshoot_day: '08-08',\n            days_lasted: 219,\n            days_left: 146,\n        },\n        '2011':{\n            overshoot_day: '08-04',\n            days_lasted: 215,\n            days_left: 150,\n            percent_lasted: 58.9\n        },\n        '2012':{\n            overshoot_day: '08-04',\n            days_lasted: 216,\n            days_left: 150,\n            percent_lasted: 59.02\n        },\n        '2013':{\n            overshoot_day: '08-03',\n            days_lasted: 214,\n            days_left: 151,\n            percent_lasted: 58.63\n        },\n        '2014':{\n            overshoot_day: '08-04',\n            days_lasted: 215,\n            days_left: 150,\n            percent_lasted: 58.9\n        },\n        '2015':{\n            overshoot_day: '08-05',\n            days_lasted: 216,\n            days_left: 149,\n            percent_lasted: 59.18\n        },\n        '2016':{\n            overshoot_day: '08-06',\n            days_lasted: 218,\n            days_left: 148,\n            percent_lasted: 59.56\n        },\n        '2017':{\n            overshoot_day: '08-01',\n            days_lasted: 212,\n            days_left: 153,\n            percent_lasted: 58.08\n        },\n        '2018':{\n            overshoot_day: '07-28',\n            days_lasted: 208,\n            days_left: 157,\n            percent_lasted: 56.99\n        },\n        '2019':{\n            overshoot_day: '07-29',\n            days_lasted: 209,\n            days_left: 156,\n            percent_lasted: 57.26\n        },\n        '2020':{\n            overshoot_day: '08-22',\n            days_lasted: 234,\n            days_left: 132,\n            percent_lasted: 63.93\n        },\n        '2021':{\n            overshoot_day: '07-30',\n            days_lasted: 210,\n            days_left: 155,\n            percent_lasted: 57.53\n        },\n        '2022':{\n            overshoot_day: '07-28',\n            days_lasted: 208,\n            days_left: 157,\n            percent_lasted: 56.99\n        }\n    };\n\n    let datasets = [];\n    let years = Object.keys(overshootDays);\n\n    for ( let year = parseInt( years[0] ); year <= parseInt( years[years.length - 1] ); year++ ){\n      let a = moment( `${year}-01-01` );\n      let b = moment( `${year}-12-31` );\n      let dataset = [];\n\n      let overshootDayPassed = false;\n\n      for ( let m = moment( a ); m.diff( b, 'days' ) <= 0; m.add( 1, 'days' ) ){\n        let date = m.format('YYYY-MM-DD');\n        if ( !overshootDayPassed && date === `${ year }-${ overshootDays[year].overshoot_day }` ){\n            overshootDayPassed = true;\n\n        }\n\n        let dt = new Date( date );\n\n        dataset.push( {\n            x: date,\n            y: Utils.isoDayOfWeek(dt),\n            overshoot_day_passed: overshootDayPassed,\n            date: date,\n            days_lasted: overshootDays[year].days_lasted,\n            percent_lasted:  Math.round( overshootDays[year].percent_lasted ),\n            days_left: overshootDays[year].days_left\n        } );\n      }\n\n      datasets.push( dataset );\n    }\n\n    // console.log( datasets );\n    const dataDescriptions = document.getElementById( 'data-descriptions' );\n\n    let html = '';\n\n    datasets.forEach( function( datapoint, index ){\n        let notes = '';\n        let dataYear = datapoint[0].date.split( '-' )[0];\n\n        switch ( dataYear ){\n            case '2020':\n                notes = ' <a href=\"https://earthobservatory.nasa.gov/images/148477/covid-19-lockdowns-cut-pollution-but-not-all-of-it\" target=\"_blank\" rel=\"noopener\">Due to COVID-19</a>, the Overshoot Day was pushed further into the year.';\n        }\n\n        let isHighlighted = index === 0 ? 'bg-dark' : '';\n\n        html += `\n          <div class=\"step --min-vh-100 p-3 ${ isHighlighted }\" data-step=\"${ index }\">\n            <h2>${dataYear} <span class=\"percent-lasted text-white\">${ datapoint[0].percent_lasted }%</span></h2>\n            <p>In ${dataYear} the Overshoot Day was on <strong>${ moment( `${dataYear}-${overshootDays[dataYear].overshoot_day}` ).format( 'MMMM DD' ) }</strong>, which means our planet lasted us <span class=\"days-lasted\">${ datapoint[0].days_lasted } days</span> with <span class=\"days-left\">${ datapoint[0].days_left } days</span> left in the year.${ notes }</p>\n          </div>\n        `;\n    } );\n\n    dataDescriptions.innerHTML = html;\n\n    Chart.defaults.color = \"#000\";\n    // Chart.defaults.borderColor = \"#8bd3dd\";\n    // Chart.defaults.backgroundColor = \"rgb(255, 99, 132)\";\n\n    // console.log( datasets[0] );\n\n    const colors = {\n        // red: '#BF625A',\n        // green: '#84D98A'\n        red: '#D98B79',\n        green: '#abd1c6'        \n    };\n\n    const data = {\n        datasets: [{\n            label: 'My Matrix',\n            data: datasets[0],\n            backgroundColor(c) {\n                // const value = c.dataset.data[c.dataIndex].v;\n                // const alpha = (10 + value) / 60;\n                // return Chart.helpers.color('green').alpha(alpha).rgbString();\n\n                return c.dataset.data[c.dataIndex].overshoot_day_passed ? colors.red : colors.green;\n            },\n            borderColor(c) {\n                // const value = c.dataset.data[c.dataIndex].v;\n                // const alpha = (10 + value) / 60;\n                // return Chart.helpers.color('green').alpha(alpha).darken(0.3).rgbString();\n                return c.dataset.data[c.dataIndex].overshoot_day_passed ? colors.red : colors.green;\n            },\n            borderWidth: 1,\n            hoverBackgroundColor: 'yellow',\n            hoverBorderColor: 'yellowgreen',\n            width(c) {\n                const a = c.chart.chartArea || {};\n                return (a.right - a.left) / 60 - 1;\n            },\n            height(c) {\n                const a = c.chart.chartArea || {};\n                return (a.bottom - a.top) / 10 - 1;\n            }\n        }]\n    };\n\n    const scales = {\n        y: {\n            type: 'time',\n            offset: true,\n            time: {\n                unit: 'day',\n                round: 'day',\n                isoWeekday: 1,\n                parser: 'd',\n                // displayFormats: {\n                //     // day: 'YYYY-MM-DD'\n                // }\n            },\n            reverse: true,\n            position: 'right',\n            ticks: {\n                display: false,\n                maxRotation: 0,\n                autoSkip: true,\n                padding: 1,\n                // font: {\n                //     size: 0\n                // }\n            },\n            grid: {\n                display: false,\n                drawBorder: false,\n                tickLength: 0\n            }\n        },\n        x: {\n            type: 'time',\n            position: 'bottom',\n            offset: true,\n            time: {\n                unit: 'week',\n                round: 'week',\n                isoWeekday: 1,\n                displayFormats: {\n                    week: 'MMMM'\n                }\n            },\n            ticks: {\n                maxRotation: 0,\n                autoSkip: true,\n                // padding: 20,\n                font: {\n                    color: '#fff',\n                    size: 12\n                }\n            },\n            grid: {\n                display: false,\n                drawBorder: false,\n                tickLength: 0,\n            }\n        }\n    };\n\n    const options = {\n        animation: false,\n        aspectRatio: 5,\n        plugins: {\n            legend: false,\n            tooltip: {\n                displayColors: false,\n                callbacks: {\n                    title() {\n                        return '';\n                    },\n                    label( context ) {\n                        const v = context.dataset.data[context.dataIndex];\n                        return moment( v.date ).format( 'MMMM DD YYYY' );\n                    }\n                }\n            },\n        },\n        scales: scales,\n        layout: {\n            padding: {\n                top: 10\n            }\n        }\n    };\n    const chart = new Chart( document.getElementById( 'chart' ), {\n        type: 'matrix',\n        data: data,\n        options: options\n    });\n\n    document.querySelector( '.col-sm-12.col-md-12.bg-white.p-0' ).classList.add( 'sticky-top' );\n    \n    const description = document.getElementById( 'description' );\n    const menuIcon = document.getElementById( 'menu-icon' );\n    const scroller = scrollama();\n\n    scroller\n        .setup( {\n            step: '.step',\n        } )\n        .onStepEnter( function( response ){\n            /* response = { direction, element, index }, */\n            // console.log( 'onStepEnter', response ); \n            // console.log( 'onStepEnter', response.index, response.direction );\n\n            let highlighted = document.querySelectorAll( '.bg-dark.step');\n\n            if ( highlighted ){\n                for ( let i = 0, j = highlighted.length; i < j; i++ ){\n                    highlighted[i].classList.remove( 'bg-dark' );\n                }\n            }\n\n            document.querySelector( `[data-step=\"${ response.index }\"]` ).classList.add( 'bg-dark' );\n\n            if ( menuIcon && ( ( response.direction === 'down' && response.index >= 0 ) || ( response.direction === 'up' && response.index <= datasets.length - 1 ) ) ){\n                menuIcon.classList.add( 'd-none' );\n                menuIcon.classList.add( 'd-md-block' );\n            }          \n\n            chart.data.datasets[0].data = datasets[response.index];\n            chart.update();\n\n            // description.innerHTML = datasets[response.index][datasets[response.index].length-1].d;\n            description.innerHTML = '';\n        } )\n        .onStepExit( function( response ){\n            /* response = { direction, element, index }, */\n            // console.log( 'onStepExit', response );\n            // console.log( 'onStepExit', response.index, response.direction );\n\n            if ( menuIcon && ( ( response.direction === 'up' && response.index === 0 ) || ( response.direction === 'down' && response.index === datasets.length - 1 ) ) ){\n                menuIcon.classList.remove( 'd-none' );\n            }\n        }\n    );\n\n    window.addEventListener( 'resize', scroller.resize );\n} );\n"],"file":"scripts.min.js"}