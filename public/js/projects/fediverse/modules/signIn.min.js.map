{"version":3,"names":[],"mappings":"","sources":["modules/signIn.js"],"sourcesContent":["/* globals ftfGlobal */\n\nimport getServerPlatform from \"/js/modules/getServerPlatform.min.js\";\nconst fediverseServerField = document.getElementById(\"fediverse-server\");\nconst signInBtn = document.getElementById(\"sign-in\");\n\nconst signIn = async (ev) => {\n  ev.preventDefault();\n\n  fediverseServerField.disabled = true;\n  signInBtn.disabled = true;\n\n  const fediverseServer = fediverseServerField.value.trim();\n\n  if (fediverseServer) {\n    localStorage.removeItem(\"fediverseUserData\");\n    const platform = await getServerPlatform(fediverseServer);\n    let platformSupported = false;\n    let authRedirectURL;\n    let authServer;\n    const app = \"mastodon-dataviz-local\";\n\n    if (ftfGlobal.node_env === \"development\") {\n      authServer = \"http://localhost:3000/\";\n    } else {\n      authServer = \"https://auth.stefanbohacek.dev/\";\n    }\n\n    switch (platform) {\n      case \"mastodon\":\n      case \"hometown\":\n      case \"pixelfed\":\n      case \"friendica\":\n      case \"pleroma\":\n      case \"akkoma\":\n      case \"gotosocial\":\n        platformSupported = true;\n        authRedirectURL = `${authServer}?method=oauth&instance=${fediverseServer}&scope=read:accounts+read:follows&app=${app}`;\n        break;\n      case \"misskey\":\n      case \"calckey\":\n      case \"firefish\":\n      case \"foundkey\":\n      case \"magnetar\":\n      case \"sharkey\":\n        platformSupported = true;\n        authRedirectURL = `${authServer}?method=miauth&instance=${fediverseServer}&scope=read:account+read:following&app=${app}`;\n        break;\n      default:\n        alert(\"Sorry, this platform is not yet supported.\");\n        fediverseServerField.disabled = false;\n        signInBtn.disabled = false;\n        break;\n    }\n\n    if (platformSupported) {\n      signInBtn.innerHTML = \"Loading...\";\n      window.location.href = authRedirectURL;\n    }\n  } else {\n    fediverseServerField.focus();\n    alert(\"Please fill out the name of your instance.\");\n    fediverseServerField.disabled = false;\n    signInBtn.disabled = false;\n  }\n};\n\nexport default signIn;\n"],"file":"signIn.min.js"}