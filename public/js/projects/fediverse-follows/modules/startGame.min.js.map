{"version":3,"names":[],"mappings":"","sources":["modules/startGame.js"],"sourcesContent":["import randomFromArray from \"/js/modules/randomFromArray.min.js\";\nimport initAwesomplete from \"/js/modules/initAwesomplete.min.js\";\nimport showResults from \"./showResults.min.js\";\n\nconst loadingScreen = document.getElementById(\"loading\");\nconst profileImage = document.getElementsByClassName(\"profile-image\");\nconst accountNameEl = document.getElementById(\"account-name\");\nconst gameInterface = document.getElementById(\"viz-user\");\nconst answerForm = document.getElementById(\"answer-form\");\nconst currentAnswerEl = document.getElementById(\"current-answer\");\nconst roundCounterEl = document.getElementById(\"round-counter\");\nconst maxRoundCounterEl = document.getElementById(\"max-round-counter\");\nconst followBio = document.getElementById(\"follow-bio\");\nconst resultsSection = document.getElementById(\"results-section\");\nconst restartGameBtns = document.getElementsByClassName(\"restart-game\");\nconst skipRoundBtn = document.getElementById(\"skip-round\");\n\nlet fullUserData;\nlet follows;\nlet resumeGame = false;\nconst gameStateInit = {\n  currentRound: 1,\n  maxRounds: 10,\n  currentRoundAccountIndex: 0,\n  points: 0,\n  rounds: [],\n};\n\nlet gameState = gameStateInit;\n\nconst savedGameState = localStorage.getItem(\"fediverseFollowsGameState\");\n\nif (savedGameState) {\n  try {\n    gameState = JSON.parse(savedGameState);\n    resumeGame = true;\n  } catch (err) {\n    /* noop */\n  }\n}\n\nconst playRound = (follows) => {\n  if (gameState.currentRound > gameState.maxRounds) {\n    answerForm.classList.add(\"d-none\");\n    resultsSection.classList.remove(\"d-none\");\n    showResults(gameStateInit, gameState, fullUserData);\n    return;\n  }\n\n  currentAnswerEl.value = null;\n  roundCounterEl.innerText = gameState.currentRound;\n\n  if (!resumeGame) {\n    const usedAnswers = gameState.rounds\n      .slice(1)\n      .map((round) => round?.accountIndex);\n\n    const availableIndices = follows\n      .map((_, index) => index)\n      .filter((index) => !usedAnswers.includes(index));\n\n    gameState.currentRoundAccountIndex = randomFromArray(availableIndices);\n\n    gameState.rounds[gameState.currentRound] = {\n      accountIndex: gameState.currentRoundAccountIndex,\n    };\n  } else {\n    gameState.currentRoundAccountIndex =\n      gameState.rounds[gameState.currentRound]?.accountIndex;\n  }\n\n  const randomAccount = follows[gameState.currentRoundAccountIndex];\n  followBio.innerHTML = randomAccount.note;\n\n  localStorage.setItem(\"fediverseFollowsGameState\", JSON.stringify(gameState));\n  resumeGame = false;\n};\n\nconst checkAnswer = () => {\n  const userAnswer = currentAnswerEl.value.trim();\n  const currentAnswer = `${\n    follows[gameState.currentRoundAccountIndex].username\n  } (${follows[gameState.currentRoundAccountIndex].acct})`;\n\n  gameState.rounds[gameState.currentRound].userAnswer = userAnswer;\n\n  const roundResult = currentAnswer === userAnswer;\n  if (roundResult) {\n    gameState.points++;\n  }\n\n  gameState.currentRound++;\n\n  localStorage.setItem(\"fediverseFollowsGameState\", JSON.stringify(gameState));\n  playRound(follows);\n};\n\nanswerForm.addEventListener(\"submit\", (ev) => {\n  ev.preventDefault();\n  checkAnswer();\n});\n\nskipRoundBtn.addEventListener(\"click\", (ev) => {\n  ev.preventDefault();\n  gameState.rounds[gameState.currentRound].userAnswer = \"(skipped)\";\n  gameState.currentRound++;\n  localStorage.setItem(\"fediverseFollowsGameState\", JSON.stringify(gameState));\n  playRound(follows);\n});\n\n[...restartGameBtns].forEach((restartGameBtn) => {\n  restartGameBtn.addEventListener(\"click\", (ev) => {\n    ev.preventDefault();\n    localStorage.removeItem(\"fediverseFollowsGameState\");\n    window.location.reload();\n  });\n});\n\nexport default async (userData) => {\n  fullUserData = userData;\n  follows = userData.follows;\n\n  loadingScreen.classList.add(\"d-none\");\n  gameInterface.classList.remove(\"d-none\");\n  gameInterface.scrollIntoView({\n    behavior: \"smooth\",\n  });\n\n  accountNameEl.innerHTML = userData.name;\n\n  if (userData.profileImageURL) {\n    profileImage[1].src = userData.profileImageURL;\n  }\n\n  initAwesomplete(\"#current-answer\", {\n    list: follows.map((account) => `${account.username} (${account.acct})`),\n    minChars: 0,\n  });\n\n  if (fullUserData?.follows?.length < 10) {\n    gameState.maxRounds = fullUserData?.follows?.length || 0;\n  }\n\n  maxRoundCounterEl.innerText = gameState.maxRounds;\n  playRound(follows);\n};\n"],"file":"startGame.min.js"}