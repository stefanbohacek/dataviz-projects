{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["/* globals Tabulator */\n\nimport ready from \"/js/modules/ready.min.js\";\nimport sortArrayOfObjects from \"/js/modules/sortArrayOfObjects.min.js\";\n\nready(async () => {\n\n  const query = `\n  SELECT DISTINCT ?org ?orgLabel ?orgTypeLabel ?hostAt ?MastName WHERE {\n    SERVICE wikibase:label {\n      bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\".\n    }\n    ?org wdt:P4033\n    ?MastName.\n    ?org wdt:P31\n    ?orgType.\n    BIND (strafter(?MastName,\"@\") AS ?hostAt). } ORDER BY ?hostAt LIMIT 20000\n  `;\n  \n  // const resp = await fetch(\n  //   `https://tools.stefanbohacek.com/wikidata/?query=${encodeURIComponent(query)}&token=Lyvgzjrheuk3dxwm8wgvpexndj5nhy8x7xihyt9ltmhknwbj1xnwpc22svoqvr`\n  // );\n\n\n  const resp = await fetch(\n    \"https://tools.stefanbohacek.com/wikidata/?query=SELECT%20DISTINCT%20%3Forg%20%3ForgLabel%20%3ForgTypeLabel%20%3FhostAt%20%3FMastName%20WHERE%20%7B%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22%5BAUTO_LANGUAGE%5D%2Cen%22.%20%7D%20%3Forg%20wdt%3AP4033%20%3FMastName.%20%3Forg%20wdt%3AP31%20%3ForgType.%20BIND%20(strafter(%3FMastName%2C%22%40%22)%20AS%20%3FhostAt).%20%7D%20ORDER%20BY%20%3FhostAt%20LIMIT%2020000&token=lYVGZjrHEUk3DxWm8WgVpExNdj5NHY8x7XiHyt9ltMhKNwbJ1XNwPC22SvoqVR\"\n  );\n\n  const fediverseAccounts = await resp.json();\n\n  const columns = [\n    {\n      title: \"Name\",\n      field: \"name\",\n      sorter: \"string\",\n      headerFilter: \"input\",\n      formatter: \"link\",\n      formatterParams: {\n        labelField: \"name\",\n        urlField: \"url\",\n        target: \"_blank\",\n      },\n    },\n    {\n      title: \"Type\",\n      field: \"type\",\n      editor: \"input\",\n      sorter: \"string\",\n      headerFilter: \"input\"\n    },\n    {\n      title: \"Account\",\n      field: \"account\",\n      sorter: \"string\",\n      headerFilter: \"input\",\n      // TODO: The account link format depends on the platform used, eg. Mastodon usernames start with @, on Pleroma they do not.\n      // formatter: \"link\",\n      // formatterParams: {\n      //   labelField: \"account\",\n      //   urlField: \"account_url\",\n      //   target: \"_blank\",\n      // },\n    },\n    {\n      title: \"Server\",\n      field: \"server\",\n      sorter: \"string\",\n      headerFilter: \"input\",\n      // headerFilter: \"list\",\n      // headerFilterParams: {\n      //   valuesLookup: true,\n      //   sortValuesList: \"asc\",\n      //   clearable: true,\n      // },      \n      formatter: \"link\",\n      formatterParams: {\n        labelField: \"server\",\n        urlField: \"server_url\",\n        target: \"_blank\",\n      },\n    },\n  ];\n\n  let data = [];\n\n  fediverseAccounts.forEach((datapoint, index) => {\n    const account = `@${datapoint?.MastName?.value}`.replace(\"@@\", \"@\");\n    if (\n      !data\n        .map((acc) => acc.account)\n        .includes(account)\n    ) {\n      const server = datapoint?.hostAt?.value;\n      const username = datapoint?.MastName?.value.replace(`@${server}`, \"\");\n\n      data.push({\n        id: index,\n        name: datapoint?.orgLabel?.value,\n        url: datapoint?.org?.value,\n        type: datapoint?.orgTypeLabel?.value,\n        account,\n        account_url: `https://${server}/@${username}`,\n        server_url: `https://${server}`,\n        server,\n      });\n    }\n  });\n\n  data = sortArrayOfObjects(data, \"type\", false);\n\n  document.getElementById(\"count-placeholder\").remove();\n  document.getElementById(\"count\").innerHTML = data.length.toLocaleString();\n  document.getElementById(\"placeholder-table\").remove();\n\n  const table = new Tabulator(\"#data\", {\n    // height: \"500px\",\n    layout: \"fitColumns\",\n    pagination: \"local\",\n    paginationSize: 25,\n    responsiveLayout: true,\n    columns,\n    data,\n  });\n\n  document.getElementById(\"download-csv\").addEventListener(\"click\", () => {\n    table.download(\"csv\", \"fediverse-accounts.csv\");\n  });\n\n  document.getElementById(\"download-json\").addEventListener(\"click\", () => {\n    table.download(\"json\", \"fediverse-accounts.json\");\n  });\n\n  document.getElementById(\"download-xlsx\").addEventListener(\"click\", () => {\n    table.download(\"xlsx\", \"fediverse-accounts.xlsx\", { sheetName: \"My Data\" });\n  });\n\n  document.getElementById(\"download-pdf\").addEventListener(\"click\", () => {\n    table.download(\"pdf\", \"fediverse-accounts.pdf\", {\n      orientation: \"portrait\",\n      title: \"Fediverse accounts\",\n    });\n  });\n\n  document.getElementById(\"download-html\").addEventListener(\"click\", () => {\n    table.download(\"html\", \"fediverse-accounts.html\", { style: true });\n  });\n});\n"],"file":"main.min.js"}